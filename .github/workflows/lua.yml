- name: Install cross-compilation toolchains
  run: |
    sudo apt-get update
    sudo apt-get install -y \
      gcc-aarch64-linux-gnu \
      gcc-arm-linux-gnueabihf \
      libc6-dev-arm64-cross \
      libc6-dev-armhf-cross

# x86_64（本地）
- name: Build liblua.a for x86_64
  working-directory: ./lua-src
  run: |
    make clean 2>/dev/null || true
    make generic MYCFLAGS="-fPIC" MYLIBS="-lm"
    mkdir -p ../output/x86_64
    cp src/liblua.a src/*.h ../output/x86_64/

# arm64
- name: Build liblua.a for arm64
  working-directory: ./lua-src
  run: |
    make clean
    make generic \
      CC=aarch64-linux-gnu-gcc \
      AR="aarch64-linux-gnu-ar rcu" \
      RANLIB=aarch64-linux-gnu-ranlib \
      MYCFLAGS="-fPIC" \
      MYLIBS="-lm"
    mkdir -p ../output/arm64
    cp src/liblua.a src/*.h ../output/arm64/

# armv7
- name: Build liblua.a for armv7
  working-directory: ./lua-src
  run: |
    make clean
    make generic \
      CC=arm-linux-gnueabihf-gcc \
      AR="arm-linux-gnueabihf-ar rcu" \
      RANLIB=arm-linux-gnueabihf-ranlib \
      MYCFLAGS="-fPIC -march=armv7-a -mfpu=vfpv3-d16 -mfloat-abi=hard" \
      MYLIBS="-lm"
    mkdir -p ../output/armv7
    cp src/liblua.a src/*.h ../output/armv7/
